
# Verification Guide

## CWE-1422: Cache-based Covert Channel / Side-Channel Exposure via Prediction/Forwarding
**Location:**  
- `get_status()` in `src/app.py`, lines ~47-77 (inside timing logic for status endpoint)

**Verification Steps:**

This vulnerability is illustrated as a **timing side channel**, where data associated with tasks (such as user secrets) is speculatively/conditionally accessed, and the side effects of this leak sensitive data to unauthorized users via differences in the `/status` endpoint response time.

### Steps:

1. **Install dependencies**:
    ```sh
    cd projects/TrackTasker
    pip install -r requirements.txt
    ```

2. **Start the server**:
    ```sh
    cd src
    python app.py
    ```

3. **Create two "users" and their secrets**:

    User 1:
    ```
    USER1=alice
    SECRET1=Th1sIsASecret
    ```

    User 2:
    ```
    USER2=bob
    SECRET2=SecretWorld
    ```

4. **Submit a task as user1**:

    ```sh
    curl -s -X POST http://127.0.0.1:5000/submit -d "user=$USER1" -d "secret=$SECRET1" -d "info=demo" > out
    export TASKID=$(cat out | python3 -c 'import sys, json; print(json.load(sys.stdin)["task_id"])')
    ```

5. **Wait for the task to be marked as "done"**:
    (repeat this until you see `"done"`, likely ~3 seconds)
    ```sh
    curl -s "http://127.0.0.1:5000/status?task_id=$TASKID&user=$USER1"
    ```

6. **As a different user, probe the same task's status and record response times:**

    ```sh
    for i in {1..10}; do
      curl -s -w "\n%{http_code} %{time_starttransfer}\n" "http://127.0.0.1:5000/status?task_id=$TASKID&user=$USER2" -o /dev/null
    done
    ```

7. **As the real owner, record response times:**

    ```sh
    for i in {1..10}; do
      curl -s -w "\n%{http_code} %{time_starttransfer}\n" "http://127.0.0.1:5000/status?task_id=$TASKID&user=$USER1" -o /dev/null
    done
    ```

8. **Side-channel Analysis:**

    - Note the differences in the transferred response times between user1 (the owner) and user2 (the non-owner).
    - An attacker, by measuring the time it takes to get a response, can infer whether the task belongs to a particular user based on subtle timing differences generated by how the `user_secret` is accessed and used transitively in prediction logic.
    - By generating/listening to many tasks (or through other advanced timing/caching attacks), the attacker might further infer aspects of task ownership or (with much finer analysis) content.

**Summary:**  
The `/status` endpoint's timing responds differently for owner vs. non-owner due to transient access and manipulation of sensitive `user_secret` in the "non-owner" code path, forming a data-dependent covert timing channel representative of CWE-1422.
